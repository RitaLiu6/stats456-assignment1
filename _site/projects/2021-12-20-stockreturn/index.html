<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Rita Liu: Data Science Project: Predict Stock Return Using Machine Learnings Models</title>

<meta property="description" itemprop="description" content="In this project, I and my teammates created and compared different machine learning models to predict the return of stocks in S&amp;P 500 from 1999 to 2020. The models try to capture the fundamental analysis process."/>


<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-12-20"/>
<meta property="article:created" itemprop="dateCreated" content="2021-12-20"/>
<meta name="article:author" content="Rita Liu, Duc Ngo, Sivhuo Prak"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Rita Liu: Data Science Project: Predict Stock Return Using Machine Learnings Models"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="In this project, I and my teammates created and compared different machine learning models to predict the return of stocks in S&amp;P 500 from 1999 to 2020. The models try to capture the fundamental analysis process."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Rita Liu"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Rita Liu: Data Science Project: Predict Stock Return Using Machine Learnings Models"/>
<meta property="twitter:description" content="In this project, I and my teammates created and compared different machine learning models to predict the return of stocks in S&amp;P 500 from 1999 to 2020. The models try to capture the fundamental analysis process."/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Data Science Project: Predict Stock Return Using Machine Learnings Models"]},{"type":"character","attributes":{},"value":["In this project, I and my teammates created and compared different machine learning models to predict the return of stocks in S&P 500 from 1999 to 2020. The models try to capture the fundamental analysis process."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Rita Liu, Duc Ngo, Sivhuo Prak"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":[]}},"value":[]}]}]},{"type":"character","attributes":{},"value":["12-20-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_float","code_download","code_folding"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["hide"]}]}]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["clean_macro - Sheet1.csv","FINALDATASET.csv","sector_return.gif","stockreturn_files/anchor-4.2.2/anchor.min.js","stockreturn_files/bootstrap-3.3.5/css/bootstrap-theme.css","stockreturn_files/bootstrap-3.3.5/css/bootstrap-theme.css.map","stockreturn_files/bootstrap-3.3.5/css/bootstrap-theme.min.css","stockreturn_files/bootstrap-3.3.5/css/bootstrap.css","stockreturn_files/bootstrap-3.3.5/css/bootstrap.css.map","stockreturn_files/bootstrap-3.3.5/css/bootstrap.min.css","stockreturn_files/bootstrap-3.3.5/css/cerulean.min.css","stockreturn_files/bootstrap-3.3.5/css/cosmo.min.css","stockreturn_files/bootstrap-3.3.5/css/darkly.min.css","stockreturn_files/bootstrap-3.3.5/css/flatly.min.css","stockreturn_files/bootstrap-3.3.5/css/fonts/Lato.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/LatoBold.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/LatoItalic.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/NewsCycle.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/NewsCycleBold.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/OpenSans.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/OpenSansBold.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/OpenSansBoldItalic.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/OpenSansItalic.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/OpenSansLight.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/OpenSansLightItalic.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/Raleway.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/RalewayBold.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/Roboto.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/RobotoBold.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/RobotoLight.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/RobotoMedium.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/SourceSansPro.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/SourceSansProBold.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/SourceSansProItalic.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/SourceSansProLight.ttf","stockreturn_files/bootstrap-3.3.5/css/fonts/Ubuntu.ttf","stockreturn_files/bootstrap-3.3.5/css/journal.min.css","stockreturn_files/bootstrap-3.3.5/css/lumen.min.css","stockreturn_files/bootstrap-3.3.5/css/paper.min.css","stockreturn_files/bootstrap-3.3.5/css/readable.min.css","stockreturn_files/bootstrap-3.3.5/css/sandstone.min.css","stockreturn_files/bootstrap-3.3.5/css/simplex.min.css","stockreturn_files/bootstrap-3.3.5/css/spacelab.min.css","stockreturn_files/bootstrap-3.3.5/css/united.min.css","stockreturn_files/bootstrap-3.3.5/css/yeti.min.css","stockreturn_files/bootstrap-3.3.5/fonts/glyphicons-halflings-regular.eot","stockreturn_files/bootstrap-3.3.5/fonts/glyphicons-halflings-regular.svg","stockreturn_files/bootstrap-3.3.5/fonts/glyphicons-halflings-regular.ttf","stockreturn_files/bootstrap-3.3.5/fonts/glyphicons-halflings-regular.woff","stockreturn_files/bootstrap-3.3.5/fonts/glyphicons-halflings-regular.woff2","stockreturn_files/bootstrap-3.3.5/js/bootstrap.js","stockreturn_files/bootstrap-3.3.5/js/bootstrap.min.js","stockreturn_files/bootstrap-3.3.5/js/npm.js","stockreturn_files/bootstrap-3.3.5/shim/html5shiv.min.js","stockreturn_files/bootstrap-3.3.5/shim/respond.min.js","stockreturn_files/bowser-1.9.3/bowser.min.js","stockreturn_files/distill-2.2.21/template.v2.js","stockreturn_files/figure-html/unnamed-chunk-10-1.png","stockreturn_files/figure-html/unnamed-chunk-11-1.png","stockreturn_files/figure-html/unnamed-chunk-13-1.png","stockreturn_files/figure-html/unnamed-chunk-18-1.png","stockreturn_files/figure-html/unnamed-chunk-20-1.png","stockreturn_files/figure-html/unnamed-chunk-20-2.png","stockreturn_files/figure-html/unnamed-chunk-21-1.png","stockreturn_files/figure-html/unnamed-chunk-22-1.png","stockreturn_files/figure-html/unnamed-chunk-26-1.png","stockreturn_files/figure-html/unnamed-chunk-28-1.png","stockreturn_files/figure-html/unnamed-chunk-29-1.png","stockreturn_files/figure-html/unnamed-chunk-29-2.png","stockreturn_files/figure-html/unnamed-chunk-30-1.png","stockreturn_files/figure-html/unnamed-chunk-35-1.png","stockreturn_files/figure-html/unnamed-chunk-4-1.png","stockreturn_files/figure-html/unnamed-chunk-5-1.png","stockreturn_files/figure-html/unnamed-chunk-6-1.png","stockreturn_files/figure-html/unnamed-chunk-7-1.png","stockreturn_files/figure-html5/unnamed-chunk-10-1.png","stockreturn_files/figure-html5/unnamed-chunk-11-1.png","stockreturn_files/figure-html5/unnamed-chunk-13-1.png","stockreturn_files/figure-html5/unnamed-chunk-18-1.png","stockreturn_files/figure-html5/unnamed-chunk-20-1.png","stockreturn_files/figure-html5/unnamed-chunk-20-2.png","stockreturn_files/figure-html5/unnamed-chunk-21-1.png","stockreturn_files/figure-html5/unnamed-chunk-22-1.png","stockreturn_files/figure-html5/unnamed-chunk-26-1.png","stockreturn_files/figure-html5/unnamed-chunk-28-1.png","stockreturn_files/figure-html5/unnamed-chunk-29-1.png","stockreturn_files/figure-html5/unnamed-chunk-29-2.png","stockreturn_files/figure-html5/unnamed-chunk-30-1.png","stockreturn_files/figure-html5/unnamed-chunk-31-1.png","stockreturn_files/figure-html5/unnamed-chunk-31-2.png","stockreturn_files/figure-html5/unnamed-chunk-32-1.png","stockreturn_files/figure-html5/unnamed-chunk-35-1.png","stockreturn_files/figure-html5/unnamed-chunk-37-1.png","stockreturn_files/figure-html5/unnamed-chunk-4-1.png","stockreturn_files/figure-html5/unnamed-chunk-5-1.png","stockreturn_files/figure-html5/unnamed-chunk-6-1.png","stockreturn_files/figure-html5/unnamed-chunk-7-1.png","stockreturn_files/highlightjs-9.12.0/default.css","stockreturn_files/highlightjs-9.12.0/highlight.js","stockreturn_files/highlightjs-9.12.0/textmate.css","stockreturn_files/jquery-1.11.3/jquery.min.js","stockreturn_files/jqueryui-1.11.4/images/ui-icons_444444_256x240.png","stockreturn_files/jqueryui-1.11.4/images/ui-icons_555555_256x240.png","stockreturn_files/jqueryui-1.11.4/images/ui-icons_777620_256x240.png","stockreturn_files/jqueryui-1.11.4/images/ui-icons_777777_256x240.png","stockreturn_files/jqueryui-1.11.4/images/ui-icons_cc0000_256x240.png","stockreturn_files/jqueryui-1.11.4/images/ui-icons_ffffff_256x240.png","stockreturn_files/jqueryui-1.11.4/index.html","stockreturn_files/jqueryui-1.11.4/jquery-ui.css","stockreturn_files/jqueryui-1.11.4/jquery-ui.js","stockreturn_files/jqueryui-1.11.4/jquery-ui.min.css","stockreturn_files/jqueryui-1.11.4/jquery-ui.min.js","stockreturn_files/jqueryui-1.11.4/jquery-ui.structure.css","stockreturn_files/jqueryui-1.11.4/jquery-ui.structure.min.css","stockreturn_files/jqueryui-1.11.4/jquery-ui.theme.css","stockreturn_files/jqueryui-1.11.4/jquery-ui.theme.min.css","stockreturn_files/jqueryui-1.11.4/README","stockreturn_files/kePrint-0.0.1/kePrint.js","stockreturn_files/lightable-0.0.1/lightable.css","stockreturn_files/navigation-1.1/codefolding.js","stockreturn_files/navigation-1.1/sourceembed.js","stockreturn_files/navigation-1.1/tabsets.js","stockreturn_files/popper-2.6.0/popper.min.js","stockreturn_files/tippy-6.2.7/tippy-bundle.umd.min.js","stockreturn_files/tippy-6.2.7/tippy-light-border.css","stockreturn_files/tippy-6.2.7/tippy.css","stockreturn_files/tippy-6.2.7/tippy.umd.min.js","stockreturn_files/tocify-1.9.1/jquery.tocify.css","stockreturn_files/tocify-1.9.1/jquery.tocify.js","stockreturn_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    Sans-serif;
  --mono-font:       monospace;
  --body-font:       Sans-serif;
  --navbar-font:     Fantasy;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       black;
  --text-size:        16px;
  --text-font:        "Fantasy"
  --hover-color:      black;
  --bkgd-color:       #C5CAE9;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #C5CAE9;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Data Science Project: Predict Stock Return Using Machine Learnings Models","description":"In this project, I and my teammates created and compared different machine learning models to predict the return of stocks in S&P 500 from 1999 to 2020. The models try to capture the fundamental analysis process.","authors":[{"author":"Rita Liu, Duc Ngo, Sivhuo Prak","authorURL":{},"affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-12-20T00:00:00.000+00:00","citationText":"Prak, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo">
<img src="../../initials.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Rita Liu</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">About</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Posts
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../blog.html">Blogs</a>
<a href="../../shinny.html">Shinny Apps</a>
</div>
</div>
<a href="../../projects.html">Projects</a>
<a href="https://github.com/RitaLiu6">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="https://www.linkedin.com/in/wenwen-liu-b86a7b193">
<i class="fa fa-linkedin" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Data Science Project: Predict Stock Return Using Machine Learnings Models</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>In this project, I and my teammates created and compared different machine learning models to predict the return of stocks in S&amp;P 500 from 1999 to 2020. The models try to capture the fundamental analysis process.</p></p>
</div>

<div class="d-byline">
  Rita Liu, Duc Ngo, Sivhuo Prak true 
  
<br/>12-20-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#paper-outline">Paper Outline</a></li>
<li><a href="#list-of-variables">List of Variables</a></li>
<li><a href="#loading-data">Loading data</a></li>
</ul></li>
<li><a href="#data-preprocessing">Data Preprocessing</a></li>
<li><a href="#data-visualization">Data Visualization</a></li>
<li><a href="#lasso-model">Lasso Model</a><ul>
<li><a href="#building-recipe">Building Recipe</a></li>
<li><a href="#select-tuning-parameter">Select tuning parameter</a></li>
<li><a href="#lasso-results">Lasso results</a></li>
<li><a href="#model-evaluation">Model Evaluation</a></li>
<li><a href="#interpretable-machine-learning">Interpretable Machine Learning</a></li>
</ul></li>
<li><a href="#random-forest-model">Random Forest Model</a><ul>
<li><a href="#building-random-forest-model">Building Random Forest model</a></li>
<li><a href="#random-forest-results">Random Forest results</a></li>
<li><a href="#model-evaluation-1">Model Evaluation</a></li>
<li><a href="#interpretable-machine-learning-1">Interpretable Machine Learning</a></li>
</ul></li>
<li><a href="#stacking-model">Stacking Model</a><ul>
<li><a href="#random-forest-candidate">Random Forest Candidate</a></li>
<li><a href="#lasso-candidate">LASSO Candidate</a></li>
<li><a href="#knn-candidate">KNN Candidate</a></li>
<li><a href="#stacking-all-candidates">Stacking all candidates</a></li>
<li><a href="#comparison-of-the-three-models">Comparison of the three models</a></li>
</ul></li>
<li><a href="#stock-return-prediction-for-2021">Stock Return Prediction for 2021</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>        <span class='co'># for data cleaning and plotting</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidymodels.tidymodels.org'>tidymodels</a></span><span class='op'>)</span>       <span class='co'># for modeling ... tidily</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span>        <span class='co'># for date manipulation</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://openintrostat.github.io/openintro/'>openintro</a></span><span class='op'>)</span>        <span class='co'># for the abbr2state() function</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/talgalili/gplots'>gplots</a></span><span class='op'>)</span>           <span class='co'># for col2hex() function</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>RColorBrewer</span><span class='op'>)</span>     <span class='co'># for color palettes</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/jrnold/ggthemes'>ggthemes</a></span><span class='op'>)</span>         <span class='co'># for more themes (including theme_map())</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://plotly-r.com'>plotly</a></span><span class='op'>)</span>           <span class='co'># for the ggplotly() - basic interactivity</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gganimate.com'>gganimate</a></span><span class='op'>)</span>        <span class='co'># for adding animation layers to ggplots</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/thomasp85/transformr'>transformr</a></span><span class='op'>)</span>       <span class='co'># for "tweening" (gganimate)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gif.ski/'>gifski</a></span><span class='op'>)</span>           <span class='co'># need the library for creating gifs but don't need to load each time</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://shiny.rstudio.com'>shiny</a></span><span class='op'>)</span>            <span class='co'># for creating interactive apps</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sfirke/janitor'>janitor</a></span><span class='op'>)</span>  
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://stacks.tidymodels.org/'>stacks</a></span><span class='op'>)</span>            <span class='co'># for stacking models</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://glmnet.stanford.edu'>glmnet</a></span><span class='op'>)</span>            <span class='co'># for regularized regression, including LASSO</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/imbs-hl/ranger'>ranger</a></span><span class='op'>)</span>            <span class='co'># for random forest model</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/KlausVigo/kknn'>kknn</a></span><span class='op'>)</span>              <span class='co'># for knn model</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/njtierney/naniar'>naniar</a></span><span class='op'>)</span>            <span class='co'># for examining missing values (NAs)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/moderndive/moderndive/issues'>moderndive</a></span><span class='op'>)</span>        <span class='co'># for King County housing data</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/koalaverse/vip/'>vip</a></span><span class='op'>)</span>               <span class='co'># for variable importance plots</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/rstudio/rmarkdown'>rmarkdown</a></span><span class='op'>)</span>         <span class='co'># for paged tables</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/jacobkap/fastDummies'>fastDummies</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://usemodels.tidymodels.org/'>usemodels</a></span><span class='op'>)</span>         <span class='co'># for suggesting step_XXX() functions</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://readr.tidyverse.org'>readr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://haozhu233.github.io/kableExtra/'>kableExtra</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dalex.drwhy.ai'>DALEX</a></span><span class='op'>)</span>             <span class='co'># model Agnostic Language for exploration and explanation (for model interpretation)  </span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ModelOriented.github.io/DALEXtra/'>DALEXtra</a></span><span class='op'>)</span>
<span class='fu'>theme_set</span><span class='op'>(</span><span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="introduction">Introduction</h2>
<p>The financial market is a strange place that is very hard to navigate around. We have seen Warren Buffett, Ray Dalio, Charlie Munger - the very very best who have had billions of dollars. Others, 95% of the population, lose the money instead.</p>
<p>So, how are the best of the best pick its stocks? It is from the fundamental, the technical side or the sentimental side? Within this paper, we hope to bring another perspective, using machine learning models to predict the profitability of the stock price.</p>
<h3 id="paper-outline">Paper Outline</h3>
<p>First, we will list and explain the definition of each variable in our dataset. There are 25 variables in total as listed below. The variable we are going to predict is <code>PROFIT</code>. Then, we will start to process our data by merging with the macro data and removing some unwanted variables. After processing the data, we will have a data visualization section that shows the distribution and relationship between some variables. And to find the best model, we choose to explore three machine learning models which are LASSO, Random forest and Stacking models. We use a stacking method to create the stacking model by combining three models (Lasso, Random Forest, and KNN). Lastly, we will make a stock return prediction for 2021 using the trained model with the lowest R-squared and RMSE.</p>
<h3 id="list-of-variables">List of Variables</h3>
<p>For the dataset, we includes financial information on companies in the S&amp;P 500 stock index from 1999-2021. This information was scraped from Yahoo Finance in November of 2021, and collected in a csv format for data analysis. The information includes metrics like sales, earnings, cogs, stock price, and market sector as well as macroeconomic data such as GDP or Money Supply. The goal is to analyze and model this data to better improve projections for a companys future profitability. The variables in the data set are described below:</p>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>YEAR</td>
<td>The financial year of the company</td>
</tr>
<tr class="even">
<td>COMPANY</td>
<td>The companys stock abbreviation symbol</td>
</tr>
<tr class="odd">
<td>MARKET.CAP</td>
<td>The total market capitalization of the company (Volume * Price)</td>
</tr>
<tr class="even">
<td>EARNINGS</td>
<td>The earnings in dollars for the previous year for the given company</td>
</tr>
<tr class="odd">
<td>SALES</td>
<td>How much the company sold in dollars last year</td>
</tr>
<tr class="even">
<td>CASH</td>
<td>How much cash the company has in dollars at the end of the previous year</td>
</tr>
<tr class="odd">
<td>Name</td>
<td>The full name of the company</td>
</tr>
<tr class="even">
<td>Sector</td>
<td>The name of the sector that the company is a part of</td>
</tr>
<tr class="odd">
<td>Earnings_next_year</td>
<td>The amount of money in dollars that the company earns in the following year</td>
</tr>
<tr class="even">
<td>PRICE</td>
<td>The price of the stock when it is bought</td>
</tr>
<tr class="odd">
<td>Sell</td>
<td>The price of the stock when it is sold</td>
</tr>
<tr class="even">
<td>VOLUME</td>
<td>The total number of shares that the company holds</td>
</tr>
<tr class="odd">
<td>COGS</td>
<td>The total amount the company paid as a cost directly related to the sale of products</td>
</tr>
<tr class="even">
<td>INVESTMENT</td>
<td>The total asset or item acquired with the goal of generating income or appreciation</td>
</tr>
<tr class="odd">
<td>RECIEVABLE</td>
<td>The debts owed to a company by its customers for goods that have been delivered or used but not yet paid for</td>
</tr>
<tr class="even">
<td>INVENTORY</td>
<td>How much raw materials used in production as well as the goods produced that are available for sale</td>
</tr>
<tr class="odd">
<td>DEBTS</td>
<td>How much money the company borrow from other parties</td>
</tr>
<tr class="even">
<td>CPALTT01USM657N_PC1</td>
<td>The percentage change in CPI (measure of inflation)</td>
</tr>
<tr class="odd">
<td>GDP</td>
<td>The monetary value of all finished goods and services made within a country</td>
</tr>
<tr class="even">
<td>GDP_PC1</td>
<td>The percentage change in GDP</td>
</tr>
<tr class="odd">
<td>T10Y2Y</td>
<td>Ten year treasury bonds minus two year treasury bonds</td>
</tr>
<tr class="even">
<td>M1SL</td>
<td>The total currency and other liquid instruments in a countrys economy</td>
</tr>
<tr class="odd">
<td>M1SL_PC1</td>
<td>The percentage change in money supply</td>
</tr>
<tr class="even">
<td>Earnings_next_year</td>
<td>How much profit that a company produces next year</td>
</tr>
<tr class="odd">
<td>PROFIT</td>
<td>How much the money made or lost on an investment</td>
</tr>
</tbody>
</table>
<h3 id="loading-data">Loading data</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>finalDATASET</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>"FINALDATASET.csv"</span><span class='op'>)</span>
<span class='va'>macro_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>"clean_macro - Sheet1.csv"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="data-preprocessing">Data Preprocessing</h2>
<p>For the data preprocessing, we combined our data sources and filled missing values for some fundamental factors by using the median of that value in the sector for a certain year. We also created sector dummies in this step. We then dropped some variables that are not in our interests and the splited the testing and trainning data.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data</span> <span class='op'>&lt;-</span> <span class='va'>finalDATASET</span> <span class='op'>%&gt;%</span> 
  <span class='co'># make Sector dummy variables</span>
  <span class='fu'><a href='https://jacobkap.github.io/fastDummies/reference/dummy_cols.html'>dummy_cols</a></span><span class='op'>(</span>select_columns <span class='op'>=</span> <span class='st'>"Sector"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># merge with updated macro data</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>CPALTT01USM657N_PC1</span>,
         <span class='op'>-</span><span class='va'>GDP</span>,
         <span class='op'>-</span><span class='va'>GDP_PC1</span>,
         <span class='op'>-</span><span class='va'>M1SL_PC1</span> ,
         <span class='op'>-</span><span class='va'>M1SL</span>,
         <span class='op'>-</span><span class='va'>PRICE</span>,
         <span class='op'>-</span><span class='va'>Sell</span>,
         <span class='op'>-</span><span class='va'>COMPANY</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>macro_data</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># convert Macro factors from characters to numeric</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CPALTT01USM657N_PC1"</span>,<span class='st'>"GDP"</span>,<span class='st'>"GDP_PC1"</span>,<span class='st'>"T10Y2Y"</span>,<span class='st'>"M1SL_PC1"</span>,<span class='st'>"M1SL"</span><span class='op'>)</span>,
                <span class='va'>as.numeric</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>YEAR</span>,<span class='va'>Sector</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># replacing the missing value with median od the industry in that year</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>DEBTS</span>,<span class='va'>INVESTMENTS</span>,<span class='va'>CASH</span>,<span class='va'>VOLUME</span>,<span class='va'>EARNINGS</span>,<span class='va'>COGS</span>,<span class='va'>SALES</span>,<span class='va'>RECEIVABLE</span>,<span class='va'>INVENTORY</span><span class='op'>)</span>,<span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/replace.html'>replace</a></span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>.</span><span class='op'>==</span><span class='fl'>0</span>,<span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='co'># delete less important factors -&gt; Exchange can possibily be deleted</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/pkg/naniar/man/where.html'>where</a></span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>,<span class='op'>-</span><span class='st'>"Name"</span><span class='op'>)</span>,<span class='va'>as.factor</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>Earnings_next_year</span>,<span class='op'>-</span><span class='va'>observation_date</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>drop_na</span><span class='op'>(</span><span class='op'>)</span> 

<span class='co'># filter out the data for 2021</span>
<span class='va'>final_data_2021</span> <span class='op'>&lt;-</span> <span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>YEAR</span> <span class='op'>==</span> <span class='fl'>2021</span><span class='op'>)</span>

<span class='va'>final_data</span> <span class='op'>&lt;-</span> <span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>YEAR</span> <span class='op'>&lt;</span> <span class='fl'>2021</span><span class='op'>)</span>

<span class='co'># split the data</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>327</span><span class='op'>)</span> <span class='co'>#for reproducibility</span>

<span class='va'>data_split</span> <span class='op'>&lt;-</span> <span class='fu'>initial_split</span><span class='op'>(</span><span class='va'>final_data</span>, 
                             prop <span class='op'>=</span> <span class='fl'>.75</span><span class='op'>)</span>
<span class='va'>data_training</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>data_split</span><span class='op'>)</span>
<span class='va'>data_testing</span> <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>data_split</span><span class='op'>)</span>

<span class='co'># quick look of the data </span>
<span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kable_styling.html'>kable_styling</a></span><span class='op'>(</span>bootstrap_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"striped"</span>, <span class='st'>"bordered"</span>, <span class='st'>"hover"</span>, <span class='st'>"condensed"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/scroll_box.html'>scroll_box</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='st'>"100%"</span>, height <span class='op'>=</span> <span class='st'>"300px"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-bordered table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
YEAR
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
T10Y2Y
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
VOLUME
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
MARKET CAP
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EARNINGS
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
COGS
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
SALES
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CASH
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INVESTMENTS
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
RECEIVABLE
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INVENTORY
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
DEBTS
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Name
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Sector
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
PROFIT
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Communication Services
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Consumer Discretionary
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Consumer Staples
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Energy
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Financials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Health Care
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Industrials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Information Technology
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Materials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Real Estate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Utilities
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CPALTT01USM657N_PC1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
M1SL_PC1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
M1SL
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
6426000000
</td>
<td style="text-align:right;">
176614593750
</td>
<td style="text-align:right;">
1350072000
</td>
<td style="text-align:right;">
2917617000
</td>
<td style="text-align:right;">
8458777000
</td>
<td style="text-align:right;">
534652000
</td>
<td style="text-align:right;">
1156849000
</td>
<td style="text-align:right;">
1297867000
</td>
<td style="text-align:right;">
361986000
</td>
<td style="text-align:right;">
1900000
</td>
<td style="text-align:left;">
Cisco Systems
</td>
<td style="text-align:left;">
Information Technology
</td>
<td style="text-align:right;">
139.56789
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.9
</td>
<td style="text-align:right;">
9631.127
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1102.3
</td>
</tr>
<tr>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
136000000
</td>
<td style="text-align:right;">
745875000
</td>
<td style="text-align:right;">
26900000
</td>
<td style="text-align:right;">
813900000
</td>
<td style="text-align:right;">
1458600000
</td>
<td style="text-align:right;">
202900000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
220900000
</td>
<td style="text-align:right;">
31200000
</td>
<td style="text-align:right;">
51400000
</td>
<td style="text-align:left;">
Quest Diagnostics
</td>
<td style="text-align:left;">
Health Care
</td>
<td style="text-align:right;">
63.53276
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.9
</td>
<td style="text-align:right;">
9631.127
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1102.3
</td>
</tr>
<tr>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
1603286905
</td>
<td style="text-align:right;">
32386397084
</td>
<td style="text-align:right;">
156200000
</td>
<td style="text-align:right;">
860700000
</td>
<td style="text-align:right;">
1331200000
</td>
<td style="text-align:right;">
198600000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
795500000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
374196000
</td>
<td style="text-align:left;">
Invesco
</td>
<td style="text-align:left;">
Financials
</td>
<td style="text-align:right;">
15.35842
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.9
</td>
<td style="text-align:right;">
9631.127
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1102.3
</td>
</tr>
<tr>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
91032448
</td>
<td style="text-align:right;">
1217558992
</td>
<td style="text-align:right;">
102000000
</td>
<td style="text-align:right;">
991300000
</td>
<td style="text-align:right;">
1407900000
</td>
<td style="text-align:right;">
95600000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
230000000
</td>
<td style="text-align:right;">
128300000
</td>
<td style="text-align:right;">
157900000
</td>
<td style="text-align:left;">
PerkinElmer
</td>
<td style="text-align:left;">
Health Care
</td>
<td style="text-align:right;">
156.29907
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.9
</td>
<td style="text-align:right;">
9631.127
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1102.3
</td>
</tr>
<tr>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
73297297
</td>
<td style="text-align:right;">
848645267
</td>
<td style="text-align:right;">
56500000
</td>
<td style="text-align:right;">
162900000
</td>
<td style="text-align:right;">
522100000
</td>
<td style="text-align:right;">
61500000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
288300000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
374196000
</td>
<td style="text-align:left;">
Arthur J. Gallagher &amp; Co.
</td>
<td style="text-align:left;">
Financials
</td>
<td style="text-align:right;">
11.09317
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.9
</td>
<td style="text-align:right;">
9631.127
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1102.3
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="data-visualization">Data Visualization</h2>
<p>We first explored distributions of our predictors and outcome. As the following graph suggested, all the numeric variables are severely right-skewed with some outliers. In our data, though the numbers of firms in each sector are unbalanced, we got a decent amount of data for each sector.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r">  <span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/naniar/man/where.html'>where</a></span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"Sector_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'>everything</span><span class='op'>(</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"variable"</span>, 
               values_to <span class='op'>=</span> <span class='st'>"value"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_histogram</span><span class='op'>(</span>bins <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>variable</span><span class='op'>)</span>, 
             scales <span class='op'>=</span> <span class='st'>"free"</span>,
             nrow <span class='op'>=</span> <span class='fl'>4</span>,
             ncol<span class='op'>=</span><span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-4-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/naniar/man/where.html'>where</a></span><span class='op'>(</span><span class='va'>is.factor</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'>everything</span><span class='op'>(</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"variable"</span>, 
               values_to <span class='op'>=</span> <span class='st'>"value"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_bar</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>variable</span><span class='op'>)</span>, 
             scales <span class='op'>=</span> <span class='st'>"free"</span>, 
             nrow <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>theme</span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-5-1.png" width="624" /></p>
</div>
<p>Then, we continued to explore the relationship between regressors and the outcome. By observation, we cant see a strong correlation between fundemental factors, such as investments and debts, and stock return. It may indicate that linear model is not an ideal model in this case.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>INVESTMENTS</span>, y <span class='op'>=</span> <span class='va'>PROFIT</span>,color <span class='op'>=</span> <span class='va'>YEAR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Relationship between investments and stock return"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-6-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>DEBTS</span>, y <span class='op'>=</span> <span class='va'>PROFIT</span>,color <span class='op'>=</span> <span class='va'>YEAR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Relationship between debts and stock return"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<p>With this anamiation, we could see that the returns of stocks follow a cycle, which may be influenced by macroeconomic condition. The return in 1999 and 2019 seems to be the highest for all industries. Also, we noticed that some industries vary a lot year to year, such as IT and healthcare industry.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sector_return_an</span><span class='op'>&lt;-</span><span class='va'>final_data</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>PROFIT</span>, y <span class='op'>=</span> <span class='va'>Sector</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_boxplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Sector</span><span class='op'>)</span>,
             alpha <span class='op'>=</span> <span class='fl'>.8</span>,
             size <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Spread of stock return in different sector"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"YEAR: {closest_state}"</span>,
       color <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://gganimate.com/reference/transition_states.html'>transition_states</a></span><span class='op'>(</span><span class='va'>YEAR</span><span class='op'>)</span>
  
<span class='fu'><a href='https://gganimate.com/reference/animate.html'>animate</a></span><span class='op'>(</span><span class='va'>sector_return_an</span>, duration <span class='op'>=</span> <span class='fl'>25</span><span class='op'>)</span>
<span class='fu'><a href='https://gganimate.com/reference/anim_save.html'>anim_save</a></span><span class='op'>(</span><span class='st'>"sector_return.gif"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/include_graphics.html'>include_graphics</a></span><span class='op'>(</span><span class='st'>"sector_return.gif"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="sector_return.gif" /><!-- --></p>
</div>
<p>We further explored the relationship between the industry and the potential macroeconomic influencer using graphs below. Though the relationship doesnt seem to be linear, we do see how macroeconomic condition affect each industry differently and will account for that in our model.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>YEAR</span>,<span class='va'>Sector</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>profit_por <span class='op'>=</span> <span class='va'>PROFIT</span><span class='op'>*</span><span class='va'>`MARKET CAP`</span><span class='op'>/</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>`MARKET CAP`</span>,na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>Sector_profit <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>profit_por</span><span class='op'>)</span>,
            GDP_PC1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>GDP_PC1</span><span class='op'>)</span>,
            CPALTT01USM657N_PC1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>CPALTT01USM657N_PC1</span><span class='op'>)</span>,
            Sector <span class='op'>=</span> <span class='va'>Sector</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>CPALTT01USM657N_PC1</span>,y <span class='op'>=</span> <span class='va'>Sector_profit</span>,color <span class='op'>=</span> <span class='va'>Sector</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Relationship between inflation and average return of a industry"</span>,
       x <span class='op'>=</span> <span class='st'>"Percent Change in CPI"</span>,
       y <span class='op'>=</span> <span class='st'>"Average Return of a sector"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-10-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>YEAR</span>,<span class='va'>Sector</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>profit_por <span class='op'>=</span> <span class='va'>PROFIT</span><span class='op'>*</span><span class='va'>`MARKET CAP`</span><span class='op'>/</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>`MARKET CAP`</span>,na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>Sector_profit <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>profit_por</span><span class='op'>)</span>,
            GDP_PC1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>GDP_PC1</span><span class='op'>)</span>,
            CPALTT01USM657N_PC1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>CPALTT01USM657N_PC1</span><span class='op'>)</span>,
            Sector <span class='op'>=</span> <span class='va'>Sector</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>GDP_PC1</span>,y <span class='op'>=</span> <span class='va'>Sector_profit</span>,color <span class='op'>=</span> <span class='va'>Sector</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Relationship between GDP  and average return of a industry"</span>,
       x <span class='op'>=</span> <span class='st'>"Percent Change in GDP"</span>,
       y <span class='op'>=</span> <span class='st'>"Average Return of a sector"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<h2 id="lasso-model">Lasso Model</h2>
<h3 id="building-recipe">Building Recipe</h3>
<p>In the lasso model, to account for the fact the macroeconomic condition affects each industry differently, we also included the interaction term between GDP and sector dummies.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>return_recipe</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>PROFIT</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='co'>#short-cut, . = all other vars</span>
                       data <span class='op'>=</span> <span class='va'>data_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># filter to only have data after 2020</span>
  <span class='fu'>step_filter</span><span class='op'>(</span><span class='va'>YEAR</span><span class='op'>&lt;</span><span class='fl'>2021</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_rm</span><span class='op'>(</span><span class='va'>Name</span>,<span class='va'>Sector</span>,<span class='va'>YEAR</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'>#step_rm(GDP,M1SL,Name,Sector,YEAR) %&gt;% </span>
  <span class='co'># add PE </span>
  <span class='fu'>step_mutate</span><span class='op'>(</span>PE <span class='op'>=</span> <span class='va'>`MARKET CAP`</span><span class='op'>/</span><span class='va'>EARNINGS</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='co'># Normalize all variables except for GDP</span>
  <span class='fu'>step_normalize</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, 
                 <span class='op'>-</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span>,
                 <span class='op'>-</span><span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"Sector_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># Create interaction terms</span>
  <span class='fu'>step_interact</span><span class='op'>(</span>terms <span class='op'>=</span> <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>GDP_PC1</span><span class='op'>)</span><span class='op'>:</span><span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"Sector_"</span><span class='op'>)</span><span class='op'>)</span> 
<span class='co'># show the data in recipe</span>
<span class='va'>return_recipe</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>prep</span><span class='op'>(</span><span class='va'>data_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='co'># using bake(new_data = NULL) gives same result as juice()</span>
  <span class='co'># bake(new_data = NULL)</span>
  <span class='fu'>juice</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kable_styling.html'>kable_styling</a></span><span class='op'>(</span>bootstrap_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"striped"</span>, <span class='st'>"bordered"</span>, <span class='st'>"hover"</span>, <span class='st'>"condensed"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/scroll_box.html'>scroll_box</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='st'>"100%"</span>, height <span class='op'>=</span> <span class='st'>"400px"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-bordered table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
T10Y2Y
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
VOLUME
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
MARKET CAP
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EARNINGS
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
COGS
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
SALES
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CASH
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INVESTMENTS
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
RECEIVABLE
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INVENTORY
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
DEBTS
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Communication Services
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Consumer Discretionary
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Consumer Staples
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Energy
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Financials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Health Care
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Industrials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Information Technology
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Materials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Real Estate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sector_Utilities
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CPALTT01USM657N_PC1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
M1SL_PC1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
M1SL
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
PROFIT
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
PE
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_<code>Sector_Communication Services</code>
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_<code>Sector_Consumer Discretionary</code>
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_<code>Sector_Consumer Staples</code>
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_Sector_Energy
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_Sector_Financials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_<code>Sector_Health Care</code>
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_Sector_Industrials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_<code>Sector_Information Technology</code>
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_Sector_Materials
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_<code>Sector_Real Estate</code>
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
GDP_PC1_x_Sector_Utilities
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-0.2723735
</td>
<td style="text-align:right;">
-0.2776796
</td>
<td style="text-align:right;">
-0.1486855
</td>
<td style="text-align:right;">
-0.0917829
</td>
<td style="text-align:right;">
0.0580188
</td>
<td style="text-align:right;">
-0.0545930
</td>
<td style="text-align:right;">
-0.0288145
</td>
<td style="text-align:right;">
-0.1272508
</td>
<td style="text-align:right;">
0.2467676
</td>
<td style="text-align:right;">
-0.0229636
</td>
<td style="text-align:right;">
-0.0859276
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.2262963
</td>
<td style="text-align:right;">
0.8675619
</td>
<td style="text-align:right;">
-0.4855693
</td>
<td style="text-align:right;">
-0.2097115
</td>
<td style="text-align:right;">
0.2272373
</td>
<td style="text-align:right;">
4.862932
</td>
<td style="text-align:right;">
-0.0267204
</td>
<td style="text-align:right;">
-0.4855693
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0114941
</td>
<td style="text-align:right;">
-0.3645483
</td>
<td style="text-align:right;">
-0.3727731
</td>
<td style="text-align:right;">
-0.3302514
</td>
<td style="text-align:right;">
-0.3397521
</td>
<td style="text-align:right;">
-0.4254379
</td>
<td style="text-align:right;">
-0.1789608
</td>
<td style="text-align:right;">
-0.1259446
</td>
<td style="text-align:right;">
-0.2323726
</td>
<td style="text-align:right;">
-0.3437728
</td>
<td style="text-align:right;">
-0.1643141
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.3631769
</td>
<td style="text-align:right;">
0.5412816
</td>
<td style="text-align:right;">
0.1718292
</td>
<td style="text-align:right;">
-0.1511675
</td>
<td style="text-align:right;">
0.0535694
</td>
<td style="text-align:right;">
31.080973
</td>
<td style="text-align:right;">
0.0427583
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.1718292
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.2449246
</td>
<td style="text-align:right;">
0.0645478
</td>
<td style="text-align:right;">
0.2414889
</td>
<td style="text-align:right;">
0.1524756
</td>
<td style="text-align:right;">
0.5823000
</td>
<td style="text-align:right;">
0.4369685
</td>
<td style="text-align:right;">
-0.0259228
</td>
<td style="text-align:right;">
-0.1280716
</td>
<td style="text-align:right;">
0.2363949
</td>
<td style="text-align:right;">
0.8964895
</td>
<td style="text-align:right;">
-0.0985802
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0123394
</td>
<td style="text-align:right;">
-0.0149473
</td>
<td style="text-align:right;">
-0.0473036
</td>
<td style="text-align:right;">
-0.0502295
</td>
<td style="text-align:right;">
-0.2689624
</td>
<td style="text-align:right;">
3.833942
</td>
<td style="text-align:right;">
-0.0092193
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
-0.0473036
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.8947789
</td>
<td style="text-align:right;">
-0.3967183
</td>
<td style="text-align:right;">
-0.3684586
</td>
<td style="text-align:right;">
-0.1615117
</td>
<td style="text-align:right;">
-0.3627474
</td>
<td style="text-align:right;">
-0.3298581
</td>
<td style="text-align:right;">
-0.1623081
</td>
<td style="text-align:right;">
0.7461020
</td>
<td style="text-align:right;">
-0.1097635
</td>
<td style="text-align:right;">
-0.3870415
</td>
<td style="text-align:right;">
-0.1823930
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.2725085
</td>
<td style="text-align:right;">
0.3395715
</td>
<td style="text-align:right;">
-0.0911302
</td>
<td style="text-align:right;">
-0.1572237
</td>
<td style="text-align:right;">
-0.0528192
</td>
<td style="text-align:right;">
14.945191
</td>
<td style="text-align:right;">
-0.0785878
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.0911302
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.2449246
</td>
<td style="text-align:right;">
0.4939553
</td>
<td style="text-align:right;">
-0.0346684
</td>
<td style="text-align:right;">
0.1980059
</td>
<td style="text-align:right;">
0.8122755
</td>
<td style="text-align:right;">
0.8375368
</td>
<td style="text-align:right;">
-0.1811591
</td>
<td style="text-align:right;">
-0.1045226
</td>
<td style="text-align:right;">
-0.2200460
</td>
<td style="text-align:right;">
2.2750369
</td>
<td style="text-align:right;">
-0.0843783
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4.4982437
</td>
<td style="text-align:right;">
-0.3347406
</td>
<td style="text-align:right;">
-2.5454182
</td>
<td style="text-align:right;">
-0.0744546
</td>
<td style="text-align:right;">
-0.4180667
</td>
<td style="text-align:right;">
31.682900
</td>
<td style="text-align:right;">
-0.0558299
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
-2.545418
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.4395259
</td>
<td style="text-align:right;">
-0.3311706
</td>
<td style="text-align:right;">
-0.4382907
</td>
<td style="text-align:right;">
-0.3489899
</td>
<td style="text-align:right;">
-0.3069941
</td>
<td style="text-align:right;">
-0.4045970
</td>
<td style="text-align:right;">
-0.1836506
</td>
<td style="text-align:right;">
-0.1280716
</td>
<td style="text-align:right;">
-0.2095608
</td>
<td style="text-align:right;">
-0.3170927
</td>
<td style="text-align:right;">
-0.1855777
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.3023032
</td>
<td style="text-align:right;">
-0.5236186
</td>
<td style="text-align:right;">
0.9607075
</td>
<td style="text-align:right;">
-0.3570810
</td>
<td style="text-align:right;">
-0.5234134
</td>
<td style="text-align:right;">
20.995936
</td>
<td style="text-align:right;">
-0.0307161
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.9607075
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.6729564
</td>
<td style="text-align:right;">
-0.2237800
</td>
<td style="text-align:right;">
-0.4552338
</td>
<td style="text-align:right;">
-0.3738869
</td>
<td style="text-align:right;">
-0.3595441
</td>
<td style="text-align:right;">
-0.4587357
</td>
<td style="text-align:right;">
-0.1945849
</td>
<td style="text-align:right;">
-0.1280716
</td>
<td style="text-align:right;">
-0.2405498
</td>
<td style="text-align:right;">
-0.2850657
</td>
<td style="text-align:right;">
-0.1941957
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.1707954
</td>
<td style="text-align:right;">
-1.5399158
</td>
<td style="text-align:right;">
1.1360138
</td>
<td style="text-align:right;">
-0.3590997
</td>
<td style="text-align:right;">
-0.6322063
</td>
<td style="text-align:right;">
11.643812
</td>
<td style="text-align:right;">
0.1030321
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1.1360138
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.2060955
</td>
<td style="text-align:right;">
0.3081610
</td>
<td style="text-align:right;">
-0.0327128
</td>
<td style="text-align:right;">
-0.1563413
</td>
<td style="text-align:right;">
-0.2160964
</td>
<td style="text-align:right;">
-0.2207183
</td>
<td style="text-align:right;">
-0.1852450
</td>
<td style="text-align:right;">
-0.1280716
</td>
<td style="text-align:right;">
-0.1694473
</td>
<td style="text-align:right;">
-0.1451228
</td>
<td style="text-align:right;">
-0.1450700
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.0677982
</td>
<td style="text-align:right;">
-1.7166315
</td>
<td style="text-align:right;">
1.0921872
</td>
<td style="text-align:right;">
-0.3207433
</td>
<td style="text-align:right;">
-0.6327673
</td>
<td style="text-align:right;">
15.293548
</td>
<td style="text-align:right;">
0.0406114
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
1.092187
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.0893802
</td>
<td style="text-align:right;">
-0.2873667
</td>
<td style="text-align:right;">
-0.0954271
</td>
<td style="text-align:right;">
-0.2312848
</td>
<td style="text-align:right;">
-0.3613798
</td>
<td style="text-align:right;">
-0.3727361
</td>
<td style="text-align:right;">
-0.1369855
</td>
<td style="text-align:right;">
-0.0416744
</td>
<td style="text-align:right;">
-0.2173061
</td>
<td style="text-align:right;">
-0.3870415
</td>
<td style="text-align:right;">
-0.1942280
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.0852640
</td>
<td style="text-align:right;">
-0.3358354
</td>
<td style="text-align:right;">
0.4347887
</td>
<td style="text-align:right;">
-0.3651560
</td>
<td style="text-align:right;">
-0.5242549
</td>
<td style="text-align:right;">
-21.545285
</td>
<td style="text-align:right;">
0.0860387
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.4347887
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.2723735
</td>
<td style="text-align:right;">
-0.3487931
</td>
<td style="text-align:right;">
-0.2821674
</td>
<td style="text-align:right;">
-0.3298109
</td>
<td style="text-align:right;">
-0.3547113
</td>
<td style="text-align:right;">
-0.4414711
</td>
<td style="text-align:right;">
-0.1920806
</td>
<td style="text-align:right;">
-0.1280716
</td>
<td style="text-align:right;">
-0.2337550
</td>
<td style="text-align:right;">
-0.3870415
</td>
<td style="text-align:right;">
-0.1903547
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.2262963
</td>
<td style="text-align:right;">
0.8675619
</td>
<td style="text-align:right;">
-0.4855693
</td>
<td style="text-align:right;">
-0.2097115
</td>
<td style="text-align:right;">
0.2272373
</td>
<td style="text-align:right;">
-12.137741
</td>
<td style="text-align:right;">
0.1864751
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
-0.4855693
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h3 id="select-tuning-parameter">Select tuning parameter</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>return_linear_mod</span> <span class='op'>&lt;-</span> 
  <span class='co'># Define a lasso model </span>
  <span class='co'># I believe default is mixture = 1 so probably don't need </span>
  <span class='fu'>linear_reg</span><span class='op'>(</span>mixture <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># Set the engine to "glmnet" </span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"glmnet"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># The parameters we will tune.</span>
  <span class='fu'>set_args</span><span class='op'>(</span>penalty <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># Use "regression"</span>
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>456</span><span class='op'>)</span>
<span class='va'>return_lm_wf</span> <span class='op'>&lt;-</span> 
  <span class='co'># Set up the workflow</span>
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># Add the recipe</span>
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>return_recipe</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># Add the modeling</span>
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>return_linear_mod</span><span class='op'>)</span>

<span class='va'>penalty_grid</span> <span class='op'>&lt;-</span> <span class='fu'>grid_regular</span><span class='op'>(</span><span class='fu'>penalty</span><span class='op'>(</span><span class='op'>)</span>,
                             levels <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='va'>return_cv</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>data_training</span>, v <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>

<span class='va'>return_lm_tune</span> <span class='op'>&lt;-</span> 
  <span class='va'>return_lm_wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tune_grid</span><span class='op'>(</span>
    resamples <span class='op'>=</span> <span class='va'>return_cv</span>,
    grid <span class='op'>=</span> <span class='va'>penalty_grid</span>
    <span class='op'>)</span>

<span class='va'>best_param</span><span class='op'>&lt;-</span><span class='va'>return_lm_tune</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>

<span class='va'>return_lasso_final_wf</span> <span class='op'>&lt;-</span> <span class='va'>return_lm_wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>best_param</span><span class='op'>)</span>

<span class='va'>return_lasso_final_mod</span> <span class='op'>&lt;-</span> <span class='va'>return_lasso_final_wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>data_training</span><span class='op'>)</span>

<span class='co'># visulization for best param</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>456</span><span class='op'>)</span>
<span class='va'>return_lm_tune</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rmse"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>penalty</span>, y <span class='op'>=</span> <span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_log10</span><span class='op'>(</span>
   breaks <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/trans_breaks.html'>trans_breaks</a></span><span class='op'>(</span><span class='st'>"log10"</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fl'>10</span><span class='op'>^</span><span class='va'>x</span><span class='op'>)</span>,
   labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/trans_format.html'>trans_format</a></span><span class='op'>(</span><span class='st'>"log10"</span>,<span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_parse.html'>math_format</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>^</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"penalty"</span>, y <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-13-1.png" width="624" /></p>
</div>
<h3 id="lasso-results">Lasso results</h3>
<p>The table below shows the estimate of each predictor in the Lasso Model. We can see that indicators in macroeconomics are relatively important to predict the stock return. The change in inflation and GDP all remain significant after shrinking. The interaction terms between GDP and industries also showed importance, accounting for the fact that the macroeconomic condition affects each industry differently: GDP seems to affect the stock return in Communication Services, Energy, and Consumer Discretionary sectors less.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>return_lasso_final_mod</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tidy</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>estimate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kable_styling.html'>kable_styling</a></span><span class='op'>(</span>bootstrap_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"striped"</span>, <span class='st'>"bordered"</span>, <span class='st'>"hover"</span>, <span class='st'>"condensed"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/scroll_box.html'>scroll_box</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='st'>"100%"</span>, height <span class='op'>=</span> <span class='st'>"500px"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-bordered table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
term
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
estimate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
penalty
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
M1SL
</td>
<td style="text-align:right;">
52.2489802
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
CPALTT01USM657N_PC1
</td>
<td style="text-align:right;">
22.8362276
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1
</td>
<td style="text-align:right;">
18.5139718
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
17.4206737
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_Sector_Utilities
</td>
<td style="text-align:right;">
14.5169194
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_<code>Sector_Consumer Staples</code>
</td>
<td style="text-align:right;">
10.9623359
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_<code>Sector_Health Care</code>
</td>
<td style="text-align:right;">
10.0994574
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Information Technology
</td>
<td style="text-align:right;">
9.1062940
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
T10Y2Y
</td>
<td style="text-align:right;">
8.3785234
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_<code>Sector_Real Estate</code>
</td>
<td style="text-align:right;">
7.9131832
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Communication Services
</td>
<td style="text-align:right;">
7.4629557
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Health Care
</td>
<td style="text-align:right;">
5.9942110
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Consumer Discretionary
</td>
<td style="text-align:right;">
4.8412271
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_<code>Sector_Information Technology</code>
</td>
<td style="text-align:right;">
4.0219608
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Energy
</td>
<td style="text-align:right;">
2.7587880
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
COGS
</td>
<td style="text-align:right;">
2.2012752
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_Sector_Industrials
</td>
<td style="text-align:right;">
2.0052201
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
VOLUME
</td>
<td style="text-align:right;">
0.9051955
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
INVESTMENTS
</td>
<td style="text-align:right;">
0.4845378
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
CASH
</td>
<td style="text-align:right;">
0.4031170
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
EARNINGS
</td>
<td style="text-align:right;">
0.3671604
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
RECEIVABLE
</td>
<td style="text-align:right;">
0.1688682
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
INVENTORY
</td>
<td style="text-align:right;">
0.1677270
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_Sector_Financials
</td>
<td style="text-align:right;">
0.0413482
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Materials
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
PE
</td>
<td style="text-align:right;">
-0.2304146
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
DEBTS
</td>
<td style="text-align:right;">
-0.2444685
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Industrials
</td>
<td style="text-align:right;">
-0.4250661
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_Sector_Materials
</td>
<td style="text-align:right;">
-1.0239217
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_<code>Sector_Communication Services</code>
</td>
<td style="text-align:right;">
-1.4192763
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Financials
</td>
<td style="text-align:right;">
-1.5534082
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
SALES
</td>
<td style="text-align:right;">
-3.2886701
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Real Estate
</td>
<td style="text-align:right;">
-3.3504621
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
MARKET CAP
</td>
<td style="text-align:right;">
-3.8678288
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Consumer Staples
</td>
<td style="text-align:right;">
-5.4154183
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_Sector_Energy
</td>
<td style="text-align:right;">
-5.8821361
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP_PC1_x_<code>Sector_Consumer Discretionary</code>
</td>
<td style="text-align:right;">
-8.6297519
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sector_Utilities
</td>
<td style="text-align:right;">
-8.7405789
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
M1SL_PC1
</td>
<td style="text-align:right;">
-11.4973966
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
<tr>
<td style="text-align:left;">
GDP
</td>
<td style="text-align:right;">
-16.0930330
</td>
<td style="text-align:right;">
0.0059948
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h3 id="model-evaluation">Model Evaluation</h3>
<h4 id="prediciton-precision">Prediciton precision</h4>
<p>The Lasso model does not perform well. It only explains 20% of the varaince in stock return and it also has a relatively high rmse of around 46.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>return_lm_tune</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>id</span>, <span class='va'>.metrics</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>.metrics</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rsq"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.config</span> <span class='op'>==</span> <span class='st'>"Preprocessor1_Model08"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>mean_rsq <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>.estimate</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<pre><code># A tibble: 1 x 1
  mean_rsq
     &lt;dbl&gt;
1    0.208</code></pre>
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>return_lm_tune</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>id</span>, <span class='va'>.metrics</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>.metrics</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rmse"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.config</span> <span class='op'>==</span> <span class='st'>"Preprocessor1_Model08"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>mean_rmse <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>.estimate</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<pre><code># A tibble: 1 x 1
  mean_rmse
      &lt;dbl&gt;
1      45.5</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>456</span><span class='op'>)</span>
<span class='va'>prediction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>
  <span class='va'>return_lasso_final_mod</span>,
  new_data <span class='op'>=</span> <span class='va'>data_training</span><span class='op'>)</span>

<span class='va'>training_pred</span><span class='op'>&lt;-</span><span class='va'>data_training</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>.pred <span class='op'>=</span> <span class='va'>prediction</span><span class='op'>$</span><span class='va'>.pred</span><span class='op'>)</span>
  
  
<span class='va'>training_pred</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>PROFIT</span>, 
             y <span class='op'>=</span> <span class='va'>.pred</span>,
             color <span class='op'>=</span> <span class='va'>YEAR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>.5</span>, 
             size <span class='op'>=</span> <span class='fl'>.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>slope <span class='op'>=</span> <span class='fl'>1</span>, 
              intercept <span class='op'>=</span> <span class='fl'>0</span>, 
              color <span class='op'>=</span> <span class='st'>"darkred"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>Name</span><span class='op'>)</span>,label.size <span class='op'>=</span> <span class='fl'>0.15</span>,data <span class='op'>=</span> <span class='va'>training_pred</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PROFIT</span><span class='op'>&gt;</span><span class='fl'>400</span><span class='op'>)</span> <span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Actual Return"</span>, 
       y <span class='op'>=</span> <span class='st'>"Predicted Return"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_viridis_b</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h4 id="overfitting">Overfitting</h4>
<p>Below shows the r-square and rmse on testing data. They are very similar to those on trainning data so we would safely conclude that our model did not overfit.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>return_lasso_test</span> <span class='op'>&lt;-</span> <span class='va'>return_lasso_final_wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>data_split</span><span class='op'>)</span>

<span class='co'># Metrics for model applied to test data</span>
<span class='va'>return_lasso_test</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<pre><code># A tibble: 2 x 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard      52.6   Preprocessor1_Model1
2 rsq     standard       0.206 Preprocessor1_Model1</code></pre>
</div>
<p>The following graphs show the performance of the model on the testing data:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>test_prediction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>
  <span class='va'>return_lasso_final_mod</span>,
  new_data <span class='op'>=</span> <span class='va'>data_testing</span><span class='op'>)</span>

<span class='va'>testing_lasso_pred</span><span class='op'>&lt;-</span><span class='va'>data_testing</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>.pred <span class='op'>=</span> <span class='va'>test_prediction</span><span class='op'>$</span><span class='va'>.pred</span><span class='op'>)</span>
  
  
<span class='va'>testing_lasso_pred</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>PROFIT</span>, 
             y <span class='op'>=</span> <span class='va'>.pred</span>,
             color <span class='op'>=</span> <span class='va'>YEAR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>.5</span>, 
             size <span class='op'>=</span> <span class='fl'>.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>slope <span class='op'>=</span> <span class='fl'>1</span>, 
              intercept <span class='op'>=</span> <span class='fl'>0</span>, 
              color <span class='op'>=</span> <span class='st'>"darkred"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>Name</span><span class='op'>)</span>,label.size <span class='op'>=</span> <span class='fl'>0.15</span>,data <span class='op'>=</span> <span class='va'>testing_lasso_pred</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PROFIT</span><span class='op'>&gt;</span><span class='fl'>300</span><span class='op'>)</span> <span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Actual Return"</span>, 
       y <span class='op'>=</span> <span class='st'>"Predicted Return"</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_color_viridis_b</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-18-1.png" width="624" /></p>
</div>
<h3 id="interpretable-machine-learning">Interpretable Machine Learning</h3>
<p>Again, the boxplot and the histogram of residuals, the model does not predict the return well and this may because some extreme values.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>lasso_explain</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://ModelOriented.github.io/DALEXtra/reference/explain_tidymodels.html'>explain_tidymodels</a></span><span class='op'>(</span>
    model <span class='op'>=</span> <span class='va'>return_lasso_final_mod</span>,
    data <span class='op'>=</span> <span class='va'>data_training</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>PROFIT</span><span class='op'>)</span>, 
    y <span class='op'>=</span> <span class='va'>data_training</span> <span class='op'>%&gt;%</span>  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>PROFIT</span><span class='op'>)</span>,
    label <span class='op'>=</span> <span class='st'>"lasso"</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>Preparation of a new explainer is initiated
  -&gt; model label       :  lasso 
  -&gt; data              :  7172  rows  30  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  7172  values 
  -&gt; predict function  :  yhat.workflow  will be used ( [33m default [39m )
  -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
  -&gt; model_info        :  package tidymodels , ver. 0.1.3 , task regression ( [33m default [39m ) 
  -&gt; predicted values  :  numerical, min =  -49.61277 , mean =  19.22262 , max =  121.2461  
  -&gt; residual function :  difference between y and yhat ( [33m default [39m )
  -&gt; residuals         :  numerical, min =  -146.2719 , mean =  -4.401566e-14 , max =  1002.161  
 [32m A new explainer has been created! [39m </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>lasso_mod_perf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dalex.drwhy.ai/reference/model_performance.html'>model_performance</a></span><span class='op'>(</span><span class='va'>lasso_explain</span><span class='op'>)</span>
<span class='va'>hist_plot</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>lasso_mod_perf</span>,
       geom <span class='op'>=</span> <span class='st'>"histogram"</span><span class='op'>)</span>
<span class='va'>box_plot</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>lasso_mod_perf</span>,
       geom <span class='op'>=</span> <span class='st'>"boxplot"</span><span class='op'>)</span>

<span class='va'>hist_plot</span>
</code></pre>
</div>
</details>
<img src="stockreturn_files/figure-html5/unnamed-chunk-20-1.png" width="624" />
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>box_plot</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-20-2.png" width="624" /></p>
</div>
<p>Below shows the feature importance plots generated by two different methods. We could see that macroeconomic indicators remained importance in both of the plots but market cap seems to be an crucial factor when we use permutation method.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span> <span class='co'>#since we are sampling &amp; permuting, we set a seed so we can replicate the results</span>
<span class='va'>lasso_var_imp</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://dalex.drwhy.ai/reference/model_parts.html'>model_parts</a></span><span class='op'>(</span>
    <span class='va'>lasso_explain</span>
    <span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>lasso_var_imp</span>, show_boxplots <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-21-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>return_lasso_final_mod</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-22-1.png" width="624" /></p>
</div>
<h2 id="random-forest-model">Random Forest Model</h2>
<h3 id="building-random-forest-model">Building Random Forest model</h3>
<p>To build the random forest model, we set up recipe using our training data (<code>data_training</code>), define model with <code>mtry = 6</code>, <code>min_n = 10</code> and <code>numbers of tree = 200</code>, create ranger workflow, and then we can fit the model.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># set up recipe </span>
<span class='va'>ranger_recipe</span> <span class='op'>&lt;-</span>
  <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>PROFIT</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='co'>#short-cut, . = all other vars</span>
                       data <span class='op'>=</span> <span class='va'>data_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_filter</span><span class='op'>(</span><span class='va'>YEAR</span><span class='op'>&lt;</span><span class='fl'>2021</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># remove the unwanted variables</span>
  <span class='fu'>step_rm</span><span class='op'>(</span><span class='va'>YEAR</span>,<span class='va'>Name</span>,<span class='va'>GDP</span>,<span class='va'>M1SL</span>,<span class='va'>Sector</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># add PE </span>
  <span class='fu'>step_mutate</span><span class='op'>(</span>PE <span class='op'>=</span> <span class='va'>`MARKET CAP`</span><span class='op'>/</span><span class='va'>EARNINGS</span><span class='op'>)</span>

<span class='co'>#define model</span>
<span class='va'>ranger_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>rand_forest</span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fl'>6</span>, 
              min_n <span class='op'>=</span> <span class='fl'>10</span>, 
              trees <span class='op'>=</span> <span class='fl'>200</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"ranger"</span><span class='op'>)</span>

<span class='co'>#create workflow</span>
<span class='va'>ranger_workflow</span> <span class='op'>&lt;-</span> 
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>ranger_recipe</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>ranger_spec</span><span class='op'>)</span>

<span class='co'>#fit the model</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>712</span><span class='op'>)</span> <span class='co'># for reproducibility - random sampling in random forest choosing number of variables</span>
<span class='va'>ranger_fit</span> <span class='op'>&lt;-</span> <span class='va'>ranger_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit</span><span class='op'>(</span><span class='va'>data_training</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h3 id="random-forest-results">Random Forest results</h3>
<p>The table below shows the OOB error (MSE), OOB RMSE (Root mean square error), and R squared of the stock return predictions using the random forest model above.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>metrics</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"OOB error"</span>, <span class='st'>"OOB RMSE"</span>,<span class='st'>"R Squared"</span><span class='op'>)</span>
<span class='fu'>data_frame</span><span class='op'>(</span>metrics <span class='op'>=</span> <span class='va'>metrics</span>, value<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>ranger_fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>prediction.error</span>,
                            <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>ranger_fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>prediction.error</span><span class='op'>)</span>,
                            <span class='va'>ranger_fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>r.squared</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>    metrics        value
1 OOB error 1545.1346996
2  OOB RMSE   39.3082014
3 R Squared    0.4086307</code></pre>
</div>
<h3 id="model-evaluation-1">Model Evaluation</h3>
<h4 id="prediciton-precision-traning-data">Prediciton precision (Traning data)</h4>
<p>Even though the mean rmse from the random forest (39.30787) seems to be fairly high but it is still lower than the LASSO model of 46. Thus, random forest model performs better.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1211</span><span class='op'>)</span> <span class='co'># for reproducibility</span>
<span class='va'>data_cv</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>data_training</span>, v <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>

<span class='va'>metric</span> <span class='op'>&lt;-</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>rmse</span><span class='op'>)</span>
<span class='va'>ctrl_res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stacks.tidymodels.org/reference/control_stack.html'>control_stack_resamples</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>ranger_cv</span> <span class='op'>&lt;-</span> <span class='va'>ranger_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit_resamples</span><span class='op'>(</span><span class='va'>data_cv</span>, 
                metrics <span class='op'>=</span> <span class='va'>metric</span>,
                control <span class='op'>=</span> <span class='va'>ctrl_res</span><span class='op'>)</span>

<span class='co'># Evaluation metrics averaged over all folds:</span>
<span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>ranger_cv</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<pre><code># A tibble: 1 x 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard    39.3     5    2.45 Preprocessor1_Model1</code></pre>
</div>
<p>We also plot a graph showing the actual return vs predicted return.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ranger_prediction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>
  <span class='va'>ranger_fit</span>,
  new_data <span class='op'>=</span> <span class='va'>data_training</span><span class='op'>)</span>

<span class='va'>ranger_training_pred</span><span class='op'>&lt;-</span><span class='va'>data_training</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>.pred <span class='op'>=</span> <span class='va'>ranger_prediction</span><span class='op'>$</span><span class='va'>.pred</span><span class='op'>)</span>
  
  
<span class='va'>ranger_training_pred</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>PROFIT</span>,
             y <span class='op'>=</span> <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>.5</span>,
             size <span class='op'>=</span> <span class='fl'>.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>slope <span class='op'>=</span> <span class='fl'>1</span>,
              intercept <span class='op'>=</span> <span class='fl'>0</span>,
              color <span class='op'>=</span> <span class='st'>"darkred"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Actual Return"</span>,
       y <span class='op'>=</span> <span class='st'>"Predicted Return"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-26-1.png" width="624" /></p>
</div>
<h4 id="prediciton-precision-testing-data">Prediciton precision (Testing data)</h4>
<p>The table below shows the rmse on testing data. It is a bit higher but fairly similar to the error on training data so we could say that our model did not overfit.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1211</span><span class='op'>)</span> <span class='co'># for reproducibility</span>
<span class='va'>data_cv</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>data_testing</span>, v <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>

<span class='va'>metric</span> <span class='op'>&lt;-</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>rmse</span><span class='op'>)</span>
<span class='va'>ctrl_res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stacks.tidymodels.org/reference/control_stack.html'>control_stack_resamples</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>ranger_cv</span> <span class='op'>&lt;-</span> <span class='va'>ranger_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit_resamples</span><span class='op'>(</span><span class='va'>data_cv</span>, 
                metrics <span class='op'>=</span> <span class='va'>metric</span>,
                control <span class='op'>=</span> <span class='va'>ctrl_res</span><span class='op'>)</span>

<span class='co'># Evaluation metrics averaged over all folds:</span>
<span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>ranger_cv</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<pre><code># A tibble: 1 x 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard    47.4     5    4.34 Preprocessor1_Model1</code></pre>
</div>
<p>Below is the graph showing the actual return vs.predicted return on testing data.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ranger_test_prediction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>
  <span class='va'>ranger_fit</span>,
  new_data <span class='op'>=</span> <span class='va'>data_testing</span><span class='op'>)</span>

<span class='va'>ranger_test_pred</span><span class='op'>&lt;-</span><span class='va'>data_testing</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>.pred <span class='op'>=</span> <span class='va'>ranger_test_prediction</span><span class='op'>$</span><span class='va'>.pred</span><span class='op'>)</span>
  
  
<span class='va'>ranger_test_pred</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>PROFIT</span>,
             y <span class='op'>=</span> <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>.5</span>,
             size <span class='op'>=</span> <span class='fl'>.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>slope <span class='op'>=</span> <span class='fl'>1</span>,
              intercept <span class='op'>=</span> <span class='fl'>0</span>,
              color <span class='op'>=</span> <span class='st'>"darkred"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Actual Return"</span>,
       y <span class='op'>=</span> <span class='st'>"Predicted Return"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-28-1.png" width="624" /></p>
</div>
<h3 id="interpretable-machine-learning-1">Interpretable Machine Learning</h3>
<p>Based on the box-plot and the histogram below, the residuals mostly lie between -50 to 50. But there are some a few outliners that can go up to 400.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_explain</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://ModelOriented.github.io/DALEXtra/reference/explain_tidymodels.html'>explain_tidymodels</a></span><span class='op'>(</span>
    model <span class='op'>=</span> <span class='va'>ranger_fit</span>,
    data <span class='op'>=</span> <span class='va'>data_training</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>PROFIT</span><span class='op'>)</span>, 
    y <span class='op'>=</span> <span class='va'>data_training</span> <span class='op'>%&gt;%</span>  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>PROFIT</span><span class='op'>)</span>,
    label <span class='op'>=</span> <span class='st'>"rf"</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>Preparation of a new explainer is initiated
  -&gt; model label       :  rf 
  -&gt; data              :  7172  rows  30  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  7172  values 
  -&gt; predict function  :  yhat.workflow  will be used ( [33m default [39m )
  -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
  -&gt; model_info        :  package tidymodels , ver. 0.1.3 , task regression ( [33m default [39m ) 
  -&gt; predicted values  :  numerical, min =  -76.57776 , mean =  19.57231 , max =  438.0276  
  -&gt; residual function :  difference between y and yhat ( [33m default [39m )
  -&gt; residuals         :  numerical, min =  -101.4695 , mean =  -0.3496883 , max =  599.5611  
 [32m A new explainer has been created! [39m </code></pre>
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_mod_perf</span> <span class='op'>&lt;-</span>  <span class='fu'><a href='https://dalex.drwhy.ai/reference/model_performance.html'>model_performance</a></span><span class='op'>(</span><span class='va'>rf_explain</span><span class='op'>)</span>

<span class='va'>hist_plot</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>rf_mod_perf</span>, 
       geom <span class='op'>=</span> <span class='st'>"histogram"</span><span class='op'>)</span>
<span class='va'>box_plot</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>rf_mod_perf</span>, 
       geom <span class='op'>=</span> <span class='st'>"boxplot"</span><span class='op'>)</span>

<span class='va'>hist_plot</span>
</code></pre>
</div>
</details>
<img src="stockreturn_files/figure-html5/unnamed-chunk-29-1.png" width="624" />
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>box_plot</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-29-2.png" width="624" /></p>
</div>
<p>According to the feature importance bar chart below, we can see that the top three important features are market cap, earnings, M1SL_PC1, and GDP_PC1.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span> <span class='co'>#since we are sampling &amp; permuting, we set a seed so we can replicate the results</span>
<span class='va'>rf_var_imp</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://dalex.drwhy.ai/reference/model_parts.html'>model_parts</a></span><span class='op'>(</span>
    <span class='va'>rf_explain</span>
    <span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>rf_var_imp</span>, show_boxplots <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-30-1.png" width="624" /></p>
</div>
<p>After creating two models, we then move on to the final method: stacking. For the stacking model, we also add one more model: KNN to improve the accuracy rate of the model.</p>
<h2 id="stacking-model">Stacking Model</h2>
<h3 id="random-forest-candidate">Random Forest Candidate</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ranger_recipe</span> <span class='op'>&lt;-</span> 
  <span class='fu'>recipe</span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>PROFIT</span> <span class='op'>~</span> <span class='va'>.</span>, 
         data <span class='op'>=</span> <span class='va'>data_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># Make these evaluative variables, not included in modeling</span>
  <span class='fu'>update_role</span><span class='op'>(</span><span class='fu'>all_of</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"YEAR"</span>, <span class='st'>"Name"</span>, <span class='st'>"Sector"</span><span class='op'>)</span><span class='op'>)</span>,
              new_role <span class='op'>=</span> <span class='st'>"evaluative"</span><span class='op'>)</span>

<span class='va'>ranger_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>rand_forest</span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fl'>6</span>, 
              min_n <span class='op'>=</span> <span class='fl'>10</span>, 
              trees <span class='op'>=</span> <span class='fl'>200</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"ranger"</span><span class='op'>)</span>

<span class='va'>ranger_workflow</span> <span class='op'>&lt;-</span> 
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>ranger_recipe</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>ranger_spec</span><span class='op'>)</span> 

<span class='va'>ranger_fit</span> <span class='op'>&lt;-</span> <span class='va'>ranger_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit</span><span class='op'>(</span><span class='va'>data_training</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1211</span><span class='op'>)</span> <span class='co'># for reproducibility</span>
<span class='va'>final_data_cv</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>data_training</span>, v <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>

<span class='va'>metric</span> <span class='op'>&lt;-</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>rmse</span><span class='op'>)</span>
<span class='va'>ctrl_res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stacks.tidymodels.org/reference/control_stack.html'>control_stack_resamples</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>ranger_cv</span> <span class='op'>&lt;-</span> <span class='va'>ranger_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit_resamples</span><span class='op'>(</span><span class='va'>final_data_cv</span>, 
                metrics <span class='op'>=</span> <span class='va'>metric</span>,
                control <span class='op'>=</span> <span class='va'>ctrl_res</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h3 id="lasso-candidate">LASSO Candidate</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># lasso recipe and transformation steps</span>
<span class='va'>lasso_final_data_recipe</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>PROFIT</span> <span class='op'>~</span> <span class='va'>.</span>, 
                       data <span class='op'>=</span> <span class='va'>data_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'>#step_rm(Name, Sector, YEAR, COMPANY) %&gt;%</span>
  <span class='fu'>update_role</span><span class='op'>(</span><span class='fu'>all_of</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Name"</span>,
                       <span class='st'>"Sector"</span>,
                       <span class='st'>"YEAR"</span><span class='op'>)</span><span class='op'>)</span>,
              new_role <span class='op'>=</span> <span class='st'>"evaluative"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span>, 
             <span class='op'>-</span><span class='fu'>all_outcomes</span><span class='op'>(</span><span class='op'>)</span>, 
             <span class='op'>-</span><span class='fu'>has_role</span><span class='op'>(</span>match <span class='op'>=</span> <span class='st'>"evaluative"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_normalize</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, 
                 <span class='op'>-</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#define lasso model</span>
<span class='va'>lasso_mod</span> <span class='op'>&lt;-</span> 
  <span class='fu'>linear_reg</span><span class='op'>(</span>mixture <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"glmnet"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_args</span><span class='op'>(</span>penalty <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='co'># create workflow</span>
<span class='va'>lasso_wf</span> <span class='op'>&lt;-</span> 
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>lasso_final_data_recipe</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>lasso_mod</span><span class='op'>)</span>

<span class='co'># penalty grid - changed to 10 levels</span>
<span class='va'>penalty_grid</span> <span class='op'>&lt;-</span> <span class='fu'>grid_regular</span><span class='op'>(</span><span class='fu'>penalty</span><span class='op'>(</span><span class='op'>)</span>,
                             levels <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='co'># add ctrl_grid - assures predictions and workflows are saved</span>
<span class='va'>ctrl_grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stacks.tidymodels.org/reference/control_stack.html'>control_stack_grid</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># tune the model using the same cv samples as random forest</span>

<span class='va'>lasso_tune</span> <span class='op'>&lt;-</span> 
  <span class='va'>lasso_wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tune_grid</span><span class='op'>(</span>
    resamples <span class='op'>=</span> <span class='va'>final_data_cv</span>,
    grid <span class='op'>=</span> <span class='va'>penalty_grid</span>,
    metrics <span class='op'>=</span> <span class='va'>metric</span>,
    control <span class='op'>=</span> <span class='va'>ctrl_grid</span>
    <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h3 id="knn-candidate">KNN Candidate</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># create a model definition</span>
<span class='va'>knn_mod</span> <span class='op'>&lt;-</span>
  <span class='fu'>nearest_neighbor</span><span class='op'>(</span>
    neighbors <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='st'>"k"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"kknn"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='co'># create the workflow</span>
<span class='va'>knn_wf</span> <span class='op'>&lt;-</span> 
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>knn_mod</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>lasso_final_data_recipe</span><span class='op'>)</span>

<span class='co'># tune it using 4 tuning parameters</span>
<span class='va'>knn_tune</span> <span class='op'>&lt;-</span> 
  <span class='va'>knn_wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tune_grid</span><span class='op'>(</span>
    <span class='va'>final_data_cv</span>,
    metrics <span class='op'>=</span> <span class='va'>metric</span>,
    grid <span class='op'>=</span> <span class='fl'>4</span>,
    control <span class='op'>=</span> <span class='va'>ctrl_grid</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h3 id="stacking-all-candidates">Stacking all candidates</h3>
<p>By showing and visualize the members in our stacking model, we could see that random forest model contribute the most.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data_stack</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://stacks.tidymodels.org/reference/stacks.html'>stacks</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://stacks.tidymodels.org/reference/add_candidates.html'>add_candidates</a></span><span class='op'>(</span><span class='va'>ranger_cv</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://stacks.tidymodels.org/reference/add_candidates.html'>add_candidates</a></span><span class='op'>(</span><span class='va'>lasso_tune</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://stacks.tidymodels.org/reference/add_candidates.html'>add_candidates</a></span><span class='op'>(</span><span class='va'>knn_tune</span><span class='op'>)</span>

<span class='va'>final_data_blend</span> <span class='op'>&lt;-</span> 
  <span class='va'>final_data_stack</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://stacks.tidymodels.org/reference/blend_predictions.html'>blend_predictions</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>final_data_blend</span> 
</code></pre>
</div>
</details>
<pre><code># A tibble: 2 x 3
  member        type             weight
  &lt;chr&gt;         &lt;chr&gt;             &lt;dbl&gt;
1 ranger_cv_1_1 rand_forest       0.835
2 knn_tune_1_4  nearest_neighbor  0.254</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span><span class='va'>final_data_blend</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="stockreturn_files/figure-html5/unnamed-chunk-35-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data_blend</span><span class='op'>$</span><span class='va'>metrics</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rmse"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>mean_rmse <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<pre><code># A tibble: 1 x 1
  mean_rmse
      &lt;dbl&gt;
1      39.7</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data_final_stack</span> <span class='op'>&lt;-</span> <span class='va'>final_data_blend</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://stacks.tidymodels.org/reference/fit_members.html'>fit_members</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>Table below shows the top10 prediction when we applied the model to testing data. Here, we can see that when the model predicts company with high rate of return, the actual return is high as well.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_data_final_stack</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>data_testing</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bind_cols</span><span class='op'>(</span><span class='va'>data_testing</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Name</span>, <span class='va'>.pred</span>, <span class='va'>PROFIT</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 10 x 3
   Name                  .pred PROFIT
   &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;
 1 Penn National Gaming   229. 1145. 
 2 Devon Energy           221.  239. 
 3 Nvidia                 217.  203. 
 4 Caesars Entertainment  213.  705. 
 5 Intuit                 211.   41.8
 6 Ansys                  205.   81.8
 7 PVH                    195.  207. 
 8 Occidental Petroleum   192.  158. 
 9 Verisign               192.  571. 
10 Illumina               191.  192. </code></pre>
</div>
<h3 id="comparison-of-the-three-models">Comparison of the three models</h3>
<p>With the three models, we then move on to see which model performs the best:</p>
<h4 id="lasso-model-1">Lasso model</h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>data_frame</span><span class='op'>(</span><span class='va'>return_lm_tune</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>id</span>, <span class='va'>.metrics</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>.metrics</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rsq"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.config</span> <span class='op'>==</span> <span class='st'>"Preprocessor1_Model08"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>mean_rsq <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>.estimate</span><span class='op'>)</span><span class='op'>)</span>,

<span class='va'>return_lm_tune</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>id</span>, <span class='va'>.metrics</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>.metrics</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rmse"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.config</span> <span class='op'>==</span> <span class='st'>"Preprocessor1_Model08"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>mean_rmse <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>.estimate</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>   mean_rsq mean_rmse
1 0.2079744  45.48327</code></pre>
</div>
<h4 id="random-forest-model-1">Random Forest Model</h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#OOB RMSE</span>
<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>mean_rmse <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>ranger_fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>prediction.error</span><span class='op'>)</span>,
<span class='co'># R squared</span>
mean_rsq <span class='op'>=</span> <span class='va'>ranger_fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>r.squared</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>  mean_rmse  mean_rsq
1  38.73345 0.4257979</code></pre>
</div>
<h4 id="stacking-model-1">Stacking Model</h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Stacking model: </span>
<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>final_data_blend</span><span class='op'>$</span><span class='va'>metrics</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rmse"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>mean_rmse <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span>,

<span class='va'>final_data_blend</span><span class='op'>$</span><span class='va'>metrics</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rsq"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>mean_rsq <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>  mean_rmse  mean_rsq
1  39.73178 0.4162962</code></pre>
</div>
<p>Here, we can see that compared to the three models, even though Random Forest performs better than the stacking model, stacking model use features in the Random Forest along with additional features from KNN and lasso. With that reason, we will choose stacking model as our model choice.</p>
<h2 id="stock-return-prediction-for-2021">Stock Return Prediction for 2021</h2>
<p>After picking our model, we then move on to use the model to predict the potential profit for 2021:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>hide</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>456</span><span class='op'>)</span>
<span class='va'>ytd</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>80.30</span>, <span class='fl'>39.77</span>, <span class='op'>-</span><span class='fl'>8.26</span>, <span class='fl'>11.29</span>, <span class='fl'>22.08</span>, <span class='fl'>132.51</span>, <span class='fl'>137.04</span>, <span class='op'>-</span><span class='fl'>4.22</span>, <span class='fl'>39.77</span>, <span class='fl'>20.76</span>, <span class='fl'>26.41</span>, <span class='fl'>26.34</span>, <span class='fl'>41.50</span>, <span class='fl'>178.43</span>, <span class='fl'>18.70</span>, <span class='fl'>87.29</span>, <span class='op'>-</span><span class='fl'>6.16</span>, <span class='fl'>52.58</span>, <span class='fl'>8.70</span>, <span class='op'>-</span><span class='fl'>13.70</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>456</span><span class='op'>)</span>
<span class='va'>pred_2021</span><span class='op'>&lt;-</span><span class='va'>final_data_final_stack</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>final_data_2021</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bind_cols</span><span class='op'>(</span><span class='va'>final_data_2021</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Name</span>, <span class='va'>.pred</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fl'>20</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>actual_ytd <span class='op'>=</span> <span class='va'>ytd</span><span class='op'>)</span> 
<span class='va'>pred_2021</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kable_styling.html'>kable_styling</a></span><span class='op'>(</span>bootstrap_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"striped"</span>, <span class='st'>"bordered"</span>, <span class='st'>"hover"</span>, <span class='st'>"condensed"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/column_spec.html'>column_spec</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>3</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>pred_2021</span><span class='op'>$</span><span class='va'>actual_ytd</span> <span class='op'>&lt;</span> <span class='fl'>0</span>, <span class='st'>"red"</span>, <span class='st'>"darkgreen"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/scroll_box.html'>scroll_box</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='st'>"100%"</span>, height <span class='op'>=</span> <span class='st'>"500px"</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-bordered table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Name
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
.pred
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
actual_ytd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: darkgreen !important;">
APA Corporation
</td>
<td style="text-align:right;">
67.67959
</td>
<td style="text-align:right;color: darkgreen !important;">
80.30
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Marathon Oil
</td>
<td style="text-align:right;">
63.13998
</td>
<td style="text-align:right;color: darkgreen !important;">
39.77
</td>
</tr>
<tr>
<td style="text-align:left;color: red !important;">
News Corp (Class B)
</td>
<td style="text-align:right;">
63.06597
</td>
<td style="text-align:right;color: red !important;">
-8.26
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Under Armour (Class C)
</td>
<td style="text-align:right;">
62.82090
</td>
<td style="text-align:right;color: darkgreen !important;">
11.29
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
DuPont
</td>
<td style="text-align:right;">
62.70736
</td>
<td style="text-align:right;color: darkgreen !important;">
22.08
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Ford
</td>
<td style="text-align:right;">
62.55623
</td>
<td style="text-align:right;color: darkgreen !important;">
132.51
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Norwegian Cruise Line Holdings
</td>
<td style="text-align:right;">
62.50470
</td>
<td style="text-align:right;color: darkgreen !important;">
137.04
</td>
</tr>
<tr>
<td style="text-align:left;color: red !important;">
Under Armour (Class A)
</td>
<td style="text-align:right;">
61.68342
</td>
<td style="text-align:right;color: red !important;">
-4.22
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Carnival Corporation
</td>
<td style="text-align:right;">
61.52755
</td>
<td style="text-align:right;color: darkgreen !important;">
39.77
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
DXC Technology
</td>
<td style="text-align:right;">
59.89012
</td>
<td style="text-align:right;color: darkgreen !important;">
20.76
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Halliburton
</td>
<td style="text-align:right;">
59.45987
</td>
<td style="text-align:right;color: darkgreen !important;">
26.41
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Raytheon Technologies
</td>
<td style="text-align:right;">
58.35294
</td>
<td style="text-align:right;color: darkgreen !important;">
26.34
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Devon Energy
</td>
<td style="text-align:right;">
57.31403
</td>
<td style="text-align:right;color: darkgreen !important;">
41.50
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Schlumberger
</td>
<td style="text-align:right;">
57.14758
</td>
<td style="text-align:right;color: darkgreen !important;">
178.43
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
ConocoPhillips
</td>
<td style="text-align:right;">
56.75287
</td>
<td style="text-align:right;color: darkgreen !important;">
18.70
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Baker Hughes
</td>
<td style="text-align:right;">
56.39542
</td>
<td style="text-align:right;color: darkgreen !important;">
87.29
</td>
</tr>
<tr>
<td style="text-align:left;color: red !important;">
Hess Corporation
</td>
<td style="text-align:right;">
56.39404
</td>
<td style="text-align:right;color: red !important;">
-6.16
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Southwest Airlines
</td>
<td style="text-align:right;">
56.14967
</td>
<td style="text-align:right;color: darkgreen !important;">
52.58
</td>
</tr>
<tr>
<td style="text-align:left;color: darkgreen !important;">
Bristol Myers Squibb
</td>
<td style="text-align:right;">
56.04499
</td>
<td style="text-align:right;color: darkgreen !important;">
8.70
</td>
</tr>
<tr>
<td style="text-align:left;color: red !important;">
Boeing
</td>
<td style="text-align:right;">
55.79926
</td>
<td style="text-align:right;color: red !important;">
-13.70
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="conclusion">Conclusion</h2>
<p>The weakness of our model is that the average error of prediction is still very high so if one wants to predict the exact return, our model wont be ideal. But the strength of our model is that for stocks with extremely high returns, even though the prediction might not be that precise, highly likely, our model will predict positive returns. That means, in real life, if we choose the top stocks to invest in based on our prediction, it is less likely we are going to lose money. Another strength of using a model to help with investment is that it excludes our subjective feelings.</p>
<p>To make the model better, we could do more research and add more regressors. For example, some financial indicators that are important for value investing are not reflected in our model due to the lack of data. Examples of those variables include Price to Sales, Price to Cash Flow, and Price to Book. Also, since we are concerned about the long-term return and all fundamental factors usually take longer to affect the firms, its probably helpful to do return in 2 years or 3 years or include lag of some variables in our model.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
